---
pred_bat:
  module: predbat
  class: PredBat

  # Timezone to work in  
  timezone: Europe/London
  
  # Set these to match your own GivTCP names, will need updating with your serial number
  soc_kw: sensor.givtcp_sa2243g277_soc_kwh
  soc_percent: number.givtcp_sa2243g277_target_soc
  soc_max: sensor.givtcp_sa2243g277_battery_capacity_kwh
  reserve: number.givtcp_sa2243g277_battery_power_reserve
  load_today: sensor.givtcp_sa2243g277_load_energy_today_kwh
  charge_enable: switch.givtcp_sa2243g277_enable_charge_schedule
  charge_start_time: select.givtcp_sa2243g277_charge_start_time_slot_1
  charge_end_time: select.givtcp_sa2243g277_charge_end_time_slot_1
  charge_limit: number.givtcp_sa2243g277_target_soc
  charge_rate: number.givtcp_sa2243g277_battery_charge_rate
  discharge_rate: number.givtcp_sa2243g277_battery_discharge_rate
  import_today: sensor.givtcp_sa2243g277_import_energy_today_kwh
  
  # Set these to match solcast sensor names (unlikely to need changing)
  pv_forecast_today: sensor.solcast_forecast_today
  pv_forecast_tomorrow: sensor.solcast_forecast_tomorrow
  pv_forecast_d3: sensor.solcast_forecast_d3
  pv_forecast_d4: sensor.solcast_forecast_d4
  
  # Battery loss accounts for energy lost charging the battery, 0.05 is 5%
  battery_loss: 0.05
  
  # Days previous is the number of days back to find historical load data
  days_previous: 7
  
  # Number of hours forward to forecast
  forecast_hours: 48
  
  # When car charging hold is enable loads of above theshold kwh are ignored in the simulation
  # Or if an incrementing energy sensor is provided actuals can be subtracted
  car_charging_hold: True
  car_charging_energy: sensor.wallbox_portal_added_energy
  car_charging_threshold: 6.0
  
  # Enable calculate best to work out the best battery SOC % based on cost
  calculate_best: True
  # best_soc margin : added to the final SOC estimate (in kwh) to set the battery charge level (pushes it up)
  # best_soc_min : sets the minimum charge level (in kwh) for overnight charging
  # best_soc_keep : is minimum battery level to try to keep above during the whole period of the simulation time
  best_soc_margin: 0.5
  best_soc_min: 2.0
  best_soc_keep: 1.5
  
  # Energy rates
  # Please set one of these three, if multiple are set then Octopus is used first, second rates_import/rates_export and latestly basic metric
  
  # Set  import and export entity to point to the Octopus Energy plugin
  # Needs updating with your meter number
  metric_octopus_import: sensor.octopus_energy_electricity_20l3260392_2200017612712_current_rate
  metric_octopus_export: sensor.octopus_energy_electricity_20l3260392_2200043522155_export_current_rate
  
  # Or set your actual rates across time for import and export
  # If start/end is missing it's assumed to be a fixed rate
  # Gaps are filled with metric_house from above
  rates_import:
    -  start: "23:30:00"
       end: "05:30:00"
       rate: 7.5
    -  start: "05:30:00"
       end: "23:30:00"
       rate: 40.0
       
  rates_export:
    -  rate: 7.5
    
  # Or set rates to be assumed for imports for the house, charging the battery and exports
  metric_house: 38
  metric_battery: 7.5
  metric_export: 4.2
  
  
  # If you have Octopus intelligent, enable the intelligent slot information to add to pricing
  octopus_intelligent_slot: binary_sensor.octopus_intelligent_slot
  
  # Threshold below average rates as the minimum to consider for a charge window, 0.8 = 80% of average rate
  rate_low_threshold: 0.8
  
  # When enabled the next charge window will be automatically configured based on the incoming rates
  # Only works if the charging time window has been enabled and Octopus import rates are configured (metric_octopus_import)
  # Set window minutes defines how many minutes before the charge window we should program it
  set_charge_window: True
  set_window_minutes: 30
  
  # Metric min improvement sets the minimum cost improvement that it's worth lowering the battery SOC % for
  # If it's 0 then this is disabled. I use around 5p as it's not worth trying to save less than that and risk a flat battery if the forecast is wrong
  metric_min_improvement: 5
  
  # When enable automatically set the battery SOC charge amount a defined number of minutes before charging starts
  # note it maybe set more than once if things change
  set_soc_enable: True
  set_soc_minutes: 30
  set_soc_notify: True
  
  # Set the frequency in minutes that this plugin is run
  run_every: 10
  
  # Debug enable prints lots of debug, leave off by default
  debug_enable: False
